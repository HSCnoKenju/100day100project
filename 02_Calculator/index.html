<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <!--<link rel="stylesheet" href="style.css"> -->
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    textarea {
      resize: none;
      width: 100%;
      font-size: 30px;
      text-align: right;

    }

    .keyboard {
      width: 600px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: 50px;
    }

    .display {
      width: 600px;
    }

    .box2 {
      grid-column-start: 4;
      grid-row-start: 4;
      grid-row-end: 6;
    }
  </style>
</head>

<body>
  <div class="display">
    <textarea name="" id="display" disabled readonly></textarea>
  </div>
  <div class="keyboard">
    <button id="C" value="C">C</button>
    <button class="operation" value="/">/</button>
    <button class="operation" value="*">*</button>
    <button id="CE" value="CE">CE</button>
    <button class="number" value="7">7</button>
    <button class="number" value="8">8</button>
    <button class="number" value="9">9</button>
    <button class="operation" value="-">-</button>
    <button class="number" value="4">4</button>
    <button class="number" value="5">5</button>
    <button class="number" value="6">6</button>
    <button class="operation" value="+">+</button>
    <button class="number" value="1">1</button>
    <button class="number" value="2">2</button>
    <button class="number" value="3">3</button>
    <button id="pm" value="pm">+/-</button>
    <button class="number" value="0">0</button>
    <button class="number" value=".">.</button>
    <button class="box2 operation" value="=">=</button>
  </div>
  <script>
    function debug_table() {
      let debugtable = { "inputs": validInputs, "displays": displays, "ans": ans, "operations": operations };
      console.table(debugtable);
    }

    function operationClickHandler(event) {


      if (validInputs.length != 0) {  // if first input is operation ,dont add it to validInputs list
        if (number.indexOf(validInputs[validInputs.length - 1]) == -1&&validInputs[validInputs.length - 1]!="pm") {// last input is an operation
          validInputs[validInputs.length - 1] = event.target.value;
          if (operations[operations.length - 1] != "=") {
            let lastValue = displays[displays.length - 1];
            displays[displays.length - 1] = lastValue.substring(0, lastValue.length - 1) + event.target.value;// substitute last operation simbol
          } else {
            if (event.target.value != "=")
              displays[displays.length - 1] = displays[displays.length - 1] + event.target.value;
          }
          operations[operations.length - 1] = event.target.value; //substitute last operation
        }
        else { // last input is number
          validInputs.push(event.target.value);
          if (ans.length == 0) {// first operation
            ans.push(Number(displays[displays.length - 1]));
            operations.push(event.target.value);
            displays.push(displays[displays.length - 1] + validInputs[validInputs.length - 1]);
          } else { // already one operation entered
            switch (operations[operations.length - 1]) {
              case "+":
                ans.push(Number(ans[ans.length - 1]) + Number(displays[displays.length - 1]));
                break;
              case "-":
                ans.push(Number(ans[ans.length - 1]) - Number(displays[displays.length - 1]));
                break;
              case "/":
                ans.push(Number(ans[ans.length - 1]) / Number(displays[displays.length - 1]));
                break;
              case "*":
                ans.push(Number(ans[ans.length - 1]) * Number(displays[displays.length - 1]));
                break;
              case "=":
                ans.push(Number(displays[displays.length - 1]));
                break;
              case "pm":
                //do nothing
                break;
              default:
                console.log("Errore switch , ultima operazione " + operations[operations.length - 1]);
            }

            displays.push(ans[ans.length - 1] + (event.target.value == "=" ? "" : event.target.value));
            operations.push(event.target.value);
          }

        }
        document.getElementById("display").value = displays[displays.length - 1];

        debug_table();
      }

    }
    function numberClickHandler(event) {
      // console.log(document.getElementById("display"));
      // console.log(event.target.value);

      //console.log(validInputs);
      if (validInputs.length == 0 || number.indexOf(validInputs[validInputs.length - 1]) != -1) {//last input was number or validInputs==empty list
        //don't put 2 dot in one string
        if (!(event.target.value == "." && (displays[displays.length - 1].indexOf(".") != -1))) {
          validInputs.push(event.target.value);
          displays.push(displays[displays.length - 1] + validInputs[validInputs.length - 1]);
        }
      } else // last input is  operations
      {
        validInputs.push(event.target.value);
        //console.assert(number.indexOf(validInputs[validInputs.length - 2]) != -1,"not number");
        displays.push(validInputs[validInputs.length - 1]);
      }
      // console.log(displays);
      document.getElementById("display").value = displays[displays.length - 1];

      debug_table();
    }
    const number = "0123456789.";
    var validInputs = [];
    var displays = [''];
    var ans = [];
    var operations = [];
    const numbersBtns = document.getElementsByClassName("number");

    for (let index = 0; index < numbersBtns.length; index++) {
      const element = numbersBtns[index];
      element.addEventListener("click", (event) => {
        numberClickHandler(event);
      })
    }

    const operationBtns = document.getElementsByClassName("operation");
    for (let index = 0; index < operationBtns.length; index++) {
      const element = operationBtns[index];
      element.addEventListener("click", (event) => {
        operationClickHandler(event);
      })
    }

    const plusminusBtn = document.getElementById("pm").addEventListener("click", (event) => {
      if (number.indexOf(validInputs[validInputs.length - 1]) != -1 || validInputs[validInputs.length - 1] == "pm") {// last input number
        displays.push((Number(displays[displays.length - 1]) * -1) + "");
        ans.push(Number(displays[displays.length - 1]));
        operations.push(event.target.value);

      }
      else {//last input operation 

      }
      validInputs.push(event.target.value);
      document.getElementById("display").value = displays[displays.length - 1];

      debug_table();
    })



  //numbersBtns.forEach(element=>element.addEventListener("click",numberClickHandler(event),false));


  </script>


  <script src="script.js"></script>
</body>

</html>